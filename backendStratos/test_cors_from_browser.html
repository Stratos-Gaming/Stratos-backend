<!DOCTYPE html>
<html>
<head>
    <title>CORS Test</title>
</head>
<body>
    <h1>CORS Test for Stratos Backend</h1>
    <p>Open this file in your browser at https://development.stratosgaming.com to test CORS</p>
    
    <h2>Test Results:</h2>
    <div id="results"></div>
    
    <script>
        const resultsDiv = document.getElementById('results');
        const apiUrl = 'https://api.stratosgaming.com';
        
        function log(message, isError = false) {
            const p = document.createElement('p');
            p.textContent = message;
            p.style.color = isError ? 'red' : 'green';
            resultsDiv.appendChild(p);
            console.log(message);
        }
        
        async function testEndpoint(endpoint, description) {
            log(`\n--- Testing ${description} ---`);
            try {
                const response = await fetch(`${apiUrl}${endpoint}`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                    }
                });
                
                log(`Status: ${response.status}`);
                
                // Check CORS headers
                const corsHeaders = [
                    'Access-Control-Allow-Origin',
                    'Access-Control-Allow-Credentials'
                ];
                
                for (const header of corsHeaders) {
                    const value = response.headers.get(header);
                    if (value) {
                        log(`${header}: ${value}`);
                    } else {
                        log(`${header}: NOT SET`, true);
                    }
                }
                
                // Try to read response
                try {
                    const data = await response.json();
                    log(`Response: ${JSON.stringify(data, null, 2)}`);
                } catch (e) {
                    log(`Could not parse response as JSON: ${e.message}`, true);
                }
                
            } catch (error) {
                log(`Error: ${error.message}`, true);
                if (error.message.includes('CORS')) {
                    log('This is a CORS error - the server is not sending proper CORS headers', true);
                }
            }
        }
        
        // Run tests
        (async () => {
            // Test CORS test endpoint first
            await testEndpoint('/auth/cors-test', 'CORS Test Endpoint');
            
            // Test CSRF cookie endpoint
            await testEndpoint('/auth/csrf_cookie', 'CSRF Cookie Endpoint');
            
            // Test authenticated check
            await testEndpoint('/auth/authenticated/', 'Authenticated Check');
        })();
    </script>
</body>
</html> 